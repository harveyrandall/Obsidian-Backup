var A=Object.create;var g=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var D=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty;var f=a=>g(a,"__esModule",{value:!0});var N=(a,t)=>{f(a);for(var n in t)g(a,n,{get:t[n],enumerable:!0})},P=(a,t,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of w(t))!H.call(a,e)&&e!=="default"&&g(a,e,{get:()=>t[e],enumerable:!(n=k(t,e))||n.enumerable});return a},h=a=>P(f(g(a!=null?A(D(a)):{},"default",a&&a.__esModule&&"default"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var p=(a,t,n)=>new Promise((e,i)=>{var s=c=>{try{l(n.next(c))}catch(m){i(m)}},r=c=>{try{l(n.throw(c))}catch(m){i(m)}},l=c=>c.done?e(c.value):Promise.resolve(c.value).then(s,r);l((n=n.apply(a,t)).next())});N(exports,{default:()=>d});var y=h(require("obsidian"));function E(a){let t=a==="next"?"nextElementSibling":"previousElementSibling";return function(n,e){let i=n[t],s=[i];for(;i;){if(i.matches(e))return s;i=i[t],s.push(i)}}}var S=E("next"),v=E("previous");var b="cm-hashtag-begin",K=`.${b}`,x="cm-hashtag-end",$=`.${x}`,o=class{constructor(t){this.equals=t=>this.tag===t.tag;this._text=t}get raw(){return this._text}get tag(){return`#${this._text}`}get subTags(){return this._text.split("/").reduce((t,n,e)=>{let i=e>0?t[e-1]:null,s=i?`${i.raw}/${n}`:n;return[...t,o.create(s)]},[])}get hasSubTags(){return this.subTags.filter(t=>!t.equals(this)).length>0}static isTagNode(t){return t instanceof o?!0:t.classList.contains("tag")||t.classList.contains("cm-hashtag")}static buildTagFromPartial(t){let n=v(t,K),e=S(t,$),i=t.classList,s=[];i.contains(x)?s=[...n,t]:i.contains(b)?s=[t,...e]:s=[...n,t,...e];let r=s.map(l=>l.textContent).join("");return o.create(r)}static create(t){if(t instanceof o)return t;let n=typeof t=="string"?t:t.textContent;return new o(n.replace("#",""))}static equals(t,n){return t.equals(n)}};var F=h(require("obsidian"));var M=h(require("obsidian"));function C(a,t){let n=a.vault.getMarkdownFiles(),e=new Set;for(let i of n){let s=(0,M.getAllTags)(a.metadataCache.getCache(i.path))||[];!s.length||s.indexOf(t.tag)===-1||e.add(i)}return e}function q(){return navigator.platform.startsWith("Mac")}function O(a){return q()?a.metaKey:a.ctrlKey}function R(a,t,n,e){return p(this,null,function*(){let i=a.metadataCache.getFirstLinkpathDest(t,n.path),s=a.vault.getConfig("defaultViewMode");yield a.workspace.getLeaf(O(e)).openFile(i,{active:!0,mode:s})})}function L(a,t,n){let e=u("a",t.basename);return e.style.cursor="pointer",e.dataset.href=t.path,e.classList.add("internal-link"),e.onclick=i=>{R(a,t.path,t,i),typeof n=="function"&&n(i)},e}function u(a,t){let n=document.createElement(a);return n.setText(t),n}function _(a,t){return a.name>t.name?1:a.name<t.name?-1:0}var T=class extends F.Modal{constructor(t,n){super(t);this.tag=n;this.onSelectTag=t=>{this.tag=o.create(t),this.contentEl.empty(),this.renderContent()};this.renderSubTagScope=t=>{let n=this.originalTag.subTags.filter(i=>!i.equals(this.tag)),e=t.createEl("select",{cls:"dropdown"});e.style.marginBottom="1em",e.value=this.tag.tag,e.onchange=i=>{this.onSelectTag(i.target.value)},e.createEl("option",{value:"",text:"Change tag scope"}),n.forEach(i=>{e.createEl("option",{value:i.tag,text:i.tag})})};this.originalTag=n}onOpen(){this.renderContent()}onClose(){this.contentEl.empty()}renderContent(){let t=this.tag,n=C(this.app,t),e=document.createDocumentFragment();e.appendChild(u("h2",`Pages with ${t.tag}`)),this.originalTag.hasSubTags&&this.renderSubTagScope(e),n.size===0?this.renderEmptyContent(e):this.renderLinks(e,n),this.contentEl.appendChild(e)}renderLinks(t,n){let e=document.createElement("ol"),i=Array.from(n).sort(_);for(let s of i){let r=document.createElement("li"),l=L(this.app,s,()=>this.close());r.appendChild(l),t.appendChild(r)}t.appendChild(e)}renderEmptyContent(t){t.appendChild(u("p","There are no pages containing this tag"))}};var d=class extends y.Plugin{onload(){return p(this,null,function*(){this.registerDomEvent(document,"click",t=>{this.handleClick(t.target)})})}handleClick(t){var s;if(!o.isTagNode(t))return;let n=this.app.workspace.activeLeaf.getViewState(),e=null;if(((s=n.state)==null?void 0:s.mode)==="source"?e=o.buildTagFromPartial(t):e=o.create(t),!e){console.error("Tag is empty",{viewState:n,target:t});return}new T(this.app,e).open()}};0&&(module.exports={});
